<?php
/*  graph.php  – pixel-perfect clone of the original Steam Flash player-count graph  */
header('Content-Type: text/html; charset=UTF-8');

/* -------------------------------------------------------------
 *  DATA  (reverse-engineered from the PNG; unchanged since v1)
 * ----------------------------------------------------------- */
$data = [
        ['t'=> '2025-09-06 00:00', 'v'=> 76324],
        ['t'=> '2025-09-06 01:25', 'v'=> 57367],
        ['t'=> '2025-09-06 03:12', 'v'=> 48428],
        ['t'=> '2025-09-06 04:37', 'v'=> 50894],
        ['t'=> '2025-09-06 06:24', 'v'=> 69851],
        ['t'=> '2025-09-06 07:50', 'v'=> 85417],
        ['t'=> '2025-09-06 09:36', 'v'=> 84492],
        ['t'=> '2025-09-06 11:02', 'v'=> 80948],
        ['t'=> '2025-09-06 12:49', 'v'=> 78636],
        ['t'=> '2025-09-06 14:14', 'v'=> 63378],
        ['t'=> '2025-09-06 16:01', 'v'=> 48428],
        ['t'=> '2025-09-06 17:26', 'v'=> 49969],
        ['t'=> '2025-09-06 19:13', 'v'=> 68464],
        ['t'=> '2025-09-06 20:39', 'v'=> 84184],
        ['t'=> '2025-09-06 22:25', 'v'=> 78636],
        ['t'=> '2025-09-06 23:51', 'v'=> 75399],
        ['t'=> '2025-09-07 01:38', 'v'=> 70947],
        ['t'=> '2025-09-07 03:03', 'v'=> 48389],
        ['t'=> '2025-09-07 04:50', 'v'=> 45923],
        ['t'=> '2025-09-07 06:16', 'v'=> 64318],
        ['t'=> '2025-09-07 08:02', 'v'=> 80039],
        ['t'=> '2025-09-07 09:28', 'v'=> 83099],
        ['t'=> '2025-09-07 11:15', 'v'=> 81558],
        ['t'=> '2025-09-07 12:40', 'v'=> 67400],
        ['t'=> '2025-09-07 14:27', 'v'=> 50933],
        ['t'=> '2025-09-07 15:53', 'v'=> 51798],
        ['t'=> '2025-09-07 17:39', 'v'=> 71025],
        ['t'=> '2025-09-07 19:05', 'v'=> 86618],
        ['t'=> '2025-09-07 20:52', 'v'=> 85753],
        ['t'=> '2025-09-07 22:18', 'v'=> 82352],
        ['t'=> '2025-09-08 00:05', 'v'=> 80155],
        ['t'=> '2025-09-08 01:30', 'v'=> 57367],
        ['t'=> '2025-09-08 03:17', 'v'=> 45923],
        ['t'=> '2025-09-08 04:42', 'v'=> 48389],
        ['t'=> '2025-09-08 06:29', 'v'=> 65922],
        ['t'=> '2025-09-08 07:55', 'v'=> 84262],
        ['t'=> '2025-09-08 09:41', 'v'=> 87421],
        ['t'=> '2025-09-08 11:07', 'v'=> 83844],
        ['t'=> '2025-09-08 12:54', 'v'=> 81675],
        ['t'=> '2025-09-08 14:19', 'v'=> 65844],
        ['t'=> '2025-09-08 16:06', 'v'=> 50933],
        ['t'=> '2025-09-08 17:32', 'v'=> 52405],
        ['t'=> '2025-09-08 19:18', 'v'=> 72586],
        ['t'=> '2025-09-08 20:44', 'v'=> 89611],
        ['t'=> '2025-09-08 22:31', 'v'=> 88468],
        ['t'=> '2025-09-09 00:00', 'v'=> 85831],
        ['t'=> '2025-09-09 01:26', 'v'=> 82115],
        ['t'=> '2025-09-09 03:12', 'v'=> 60517],
        ['t'=> '2025-09-09 04:38', 'v'=> 50894],
        ['t'=> '2025-09-09 06:25', 'v'=> 69890],
        ['t'=> '2025-09-09 07:51', 'v'=> 90138],
        ['t'=> '2025-09-09 09:37', 'v'=> 92746],
        ['t'=> '2025-09-09 11:03', 'v'=> 88885],
        ['t'=> '2025-09-09 12:50', 'v'=> 86248],
        ['t'=> '2025-09-09 14:15', 'v'=> 69473],
        ['t'=> '2025-09-09 16:02', 'v'=> 53448],
        ['t'=> '2025-09-09 17:28', 'v'=> 55067],
        ['t'=> '2025-09-09 19:15', 'v'=> 74575],
        ['t'=> '2025-09-09 20:41', 'v'=> 92507],
        ['t'=> '2025-09-09 22:27', 'v'=> 91582],
        ['t'=> '2025-09-10 00:00', 'v'=> 88468],
        ['t'=> '2025-09-10 01:25', 'v'=> 84734],
        ['t'=> '2025-09-10 03:12', 'v'=> 63693],
        ['t'=> '2025-09-10 04:38', 'v'=> 50894],
        ['t'=> '2025-09-10 06:24', 'v'=> 69851],
        ['t'=> '2025-09-10 07:50', 'v'=> 92507],
        ['t'=> '2025-09-10 09:36', 'v'=> 91582],
        ['t'=> '2025-09-10 11:02', 'v'=> 82797],
        ['t'=> '2025-09-10 12:49', 'v'=> 75862],
        ['t'=> '2025-09-10 14:14', 'v'=> 75862],
        ['t'=> '2025-09-10 16:01', 'v'=> 74320],
        ['t'=> '2025-09-10 17:27', 'v'=> 76786],
        ['t'=> '2025-09-10 19:13', 'v'=> 77711],
        ['t'=> '2025-09-10 20:39', 'v'=> 77711],
        ['t'=> '2025-09-10 22:25', 'v'=> 80485],
        ['t'=> '2025-09-10 23:51', 'v'=> 83259],
        ['t'=> '2025-09-11 01:38', 'v'=> 87421],
        ['t'=> '2025-09-11 03:04', 'v'=> 93894],
        ['t'=> '2025-09-11 04:50', 'v'=> 98055],
];

/* ------------------------------------------------------------- */
?>
<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
<title>DOD player graph</title>
<style>
    html,body{margin:0;padding:0;background:#fff;font:10px/1 Verdana,Arial,sans-serif;}
    #wrap{padding:0}
    canvas{display:block;background:#fff;}
</style>
</head><body>
<div id="wrap"><canvas id="g" width="589" height="236"></canvas></div>

<script>
// ───────────────────────────────────────────────────────────────
//  CONSTANTS
// ───────────────────────────────────────────────────────────────
const cvs  = document.getElementById('g');
const ctx  = cvs.getContext('2d');

const PAD  = {l:58, r:10, t:24, b:18};          // room for Y-axis text (left) & ticks
const W    = cvs.width  - PAD.l - PAD.r;
const H    = cvs.height - PAD.t - PAD.b;

const pts  = <?php echo json_encode($data, JSON_NUMERIC_CHECK); ?>;
const YMIN = 44883, YMID = 72625, YMAX = 100367;
const GRID_Y = [YMAX, YMID, YMIN];               // draw all three – top/bottom double as frame

// helpers
const x = i   => PAD.l + i/(pts.length-1)*W;
const y = v   => PAD.t + (YMAX-v)/(YMAX-YMIN)*H;

// ───────────────────────────────────────────────────────────────
//  FRAME (2 px solid black rectangle)
// ───────────────────────────────────────────────────────────────
ctx.lineWidth = 2;  ctx.strokeStyle = '#000';
ctx.strokeRect(PAD.l, PAD.t, W, H);

// ───────────────────────────────────────────────────────────────
//  HORIZONTAL GRID  &  Y-AXIS LABELS
// ───────────────────────────────────────────────────────────────
ctx.lineWidth = 1;
ctx.textAlign = 'right'; ctx.textBaseline = 'middle'; ctx.font = '11px Verdana';

GRID_Y.forEach(val=>{
    const yy = y(val);
    // skip: top & bottom already have the frame; still draw for perfect overlap
    ctx.beginPath(); ctx.moveTo(PAD.l, yy); ctx.lineTo(PAD.l+W, yy); ctx.stroke();
    ctx.fillText(String(val), PAD.l-4, yy);
});

// ───────────────────────────────────────────────────────────────
//  DAILY MIDNIGHT SEPARATORS (black 3/4 dashed)
// ───────────────────────────────────────────────────────────────
ctx.setLineDash([4,4]);
let lastDay = null;
pts.forEach((p,i)=>{
    const d = new Date(p.t.replace(' ','T')).getDate();
    if(i===0 || d!==lastDay){
        const xx = x(i);
        ctx.beginPath(); ctx.moveTo(xx, PAD.t); ctx.lineTo(xx, PAD.t+H); ctx.stroke();
        lastDay = d;
    }
});
ctx.setLineDash([]);

// ───────────────────────────────────────────────────────────────
//  POLY-LINE & DOTS
// ───────────────────────────────────────────────────────────────
ctx.strokeStyle = '#777'; ctx.lineWidth = 1;
ctx.beginPath();
pts.forEach((p,i)=> i ? ctx.lineTo(x(i), y(p.v)) : ctx.moveTo(x(i), y(p.v)));
ctx.stroke();

// dots
ctx.fillStyle = '#550000';
pts.forEach((p,i)=>{
    ctx.beginPath(); ctx.arc(x(i), y(p.v), 2, 0, Math.PI*2); ctx.fill();
});

// ───────────────────────────────────────────────────────────────
//  DATE STRIP  (bold uppercase, centred over each dash set)
// ───────────────────────────────────────────────────────────────
ctx.font = 'bold 11px Verdana'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
lastDay = null;
pts.forEach((p,i)=>{
    const d = new Date(p.t.replace(' ','T'));
    if(d.getDate() !== lastDay){
        const label = d.toLocaleString('en-US',{month:'short'}).toUpperCase() + ' ' + d.getDate();
        ctx.fillText(label, x(i), 2);            // 2 px from canvas top matches PNG
        lastDay = d.getDate();
    }
});
</script>
</body></html>
